# 하루 한 문장 - 확장성 설계 계획서

## 📋 목차
1. [프로젝트 개요](#프로젝트-개요)
2. [확장성 요구사항 분석](#확장성-요구사항-분석)
3. [프론트엔드 아키텍처](#프론트엔드-아키텍처)
4. [백엔드 아키텍처](#백엔드-아키텍처)
5. [Firebase 활용 전략](#firebase-활용-전략)
6. [폴더 구조 및 코드 조직](#폴더-구조-및-코드-조직)
7. [성능 최적화 계획](#성능-최적화-계획)
8. [CI/CD 및 배포 전략](#cicd-및-배포-전략)
9. [단계별 실행 계획](#단계별-실행-계획)

---

## 프로젝트 개요

### 🎯 아키텍처 개요
```
🏗️ 전체 시스템 구조:
React + TypeScript + MUI (Frontend)
    ↕️
Firebase Functions + TypeScript (Backend)
    ↕️
Firebase Firestore (Database)
```

### 🔧 핵심 기술 스택
- **프론트엔드**: React 18 + TypeScript + Material-UI + Zustand
- **백엔드**: Firebase Functions + TypeScript + Express 패턴
- **데이터베이스**: Firebase Firestore (NoSQL)
- **상태 관리**: Zustand (전역) + TanStack Query (서버 상태)
- **빌드/배포**: Vite + GitHub Actions + Firebase Hosting

---

## 확장성 요구사항 분석

### 📈 확장 시나리오

| 영역 | 현재 (MVP) | 6개월 후 | 1년 후 |
|------|------------|----------|--------|
| **사용자** | 익명 방문자 | 회원가입, 개인화 | 소셜 로그인, 커뮤니티 |
| **트래픽** | 100명/일 | 10,000명/일 | 100,000명/일 |
| **기능** | 글보기, 공감, 제출 | 북마크, 검색, 카테고리 | 개인 컬렉션, 공유, 댓글 |
| **플랫폼** | 웹 only | PWA 추가 | 모바일 앱, 브라우저 확장 |
| **콘텐츠** | 텍스트만 | 이미지 인용구 | 동영상, 오디오, 다국어 |

### 🎯 확장성 고려사항
1. **성능**: 레이지 로딩, 코드 스플리팅, 캐싱 전략
2. **확장성**: 모듈화, 컴포넌트 재사용, 서비스 레이어 분리
3. **유지보수성**: 타입 안정성, 테스트 커버리지, 문서화
4. **비용 효율성**: Firebase 요금제 최적화, 리소스 관리

---

## 프론트엔드 아키텍처

### 🎨 컴포넌트 아키텍처 (Atomic Design)
```
📁 src/components/
├── 🔹 atoms/          # 최소 단위 (Button, Input, Text)
├── 🔸 molecules/      # 조합 컴포넌트 (SearchBar, LikeButton)
├── 🔷 organisms/      # 복합 컴포넌트 (QuoteCard, Header, SubmissionForm)
├── 📄 templates/      # 페이지 레이아웃
└── 🏠 pages/          # 페이지 컴포넌트
```

### 📊 상태 관리 전략
```typescript
// 전역 상태: Zustand (가벼움 + 확장성)
interface AppStore {
  // UI 상태
  theme: 'light' | 'dark';
  isLoading: boolean;

  // 비즈니스 상태
  currentQuote: Quote | null;
  likeCount: number;

  // 액션들
  setTheme: (theme: 'light' | 'dark') => void;
  incrementLike: () => void;
}

// 서버 상태: TanStack Query
const useQuote = () => useQuery({
  queryKey: ['quote', 'today'],
  queryFn: getTodaysQuote,
  staleTime: 1000 * 60 * 30 // 30분
});
```

### 🛣️ 라우팅 구조
```typescript
// 코드 스플리팅 + 레이지 로딩
const HomePage = lazy(() => import('@/pages/HomePage'));
const SubmitPage = lazy(() => import('@/pages/SubmitPage'));
const AdminPage = lazy(() => import('@/pages/AdminPage'));

const AppRouter = () => (
  <Router>
    <Suspense fallback={<LoadingSpinner />}>
      <Routes>
        <Route path="/" element={<HomePage />} />
        <Route path="/submit" element={<SubmitPage />} />
        <Route path="/admin" element={<ProtectedRoute><AdminPage /></ProtectedRoute>} />
      </Routes>
    </Suspense>
  </Router>
);
```

### 📝 타입 시스템
```typescript
// 도메인 타입 정의
interface Quote {
  id: string;
  type: 'quote' | 'text';
  content: string;
  like_count: number;
  last_shown_date: string;
  status: 'published' | 'hidden';
}

// API 응답 타입
type ApiResponse<T> = {
  data: T;
  error?: string;
  timestamp: number;
};

// 컴포넌트 Props 타입
interface QuoteCardProps {
  quote: Quote;
  onLike: () => void;
  onShare: () => void;
}
```

---

## 백엔드 아키텍처

### 🏗️ 레이어드 아키텍처 (Firebase 기반)
```
🏗️ Backend Architecture:
├── 🌐 Presentation Layer    # API endpoints, HTTP handlers
├── 📋 Business Layer        # 비즈니스 로직, 도메인 서비스
├── 💾 Data Access Layer     # Firestore 접근, 데이터 변환
└── 🔧 Infrastructure Layer  # Firebase 설정, 외부 API
```

### ⚡ Cloud Functions 구조
```typescript
// functions/src/index.ts
export {
  // HTTP Functions (REST API)
  getTodaysQuote,
  submitQuote,
  incrementLike,

  // Scheduled Functions
  selectDailyQuote,
  cleanupOldSubmissions,

  // Trigger Functions
  onQuoteCreated,
  onSubmissionCreated
} from './functions';

// functions/src/services/
├── QuoteService.ts      # 글 관련 비즈니스 로직
├── SubmissionService.ts # 제출 관련 비즈니스 로직
├── AdminService.ts      # 관리자 기능
└── NotificationService.ts # 알림 (향후 확장)
```

### 📋 서비스 레이어 예시
```typescript
// QuoteService.ts - 비즈니스 로직 캡슐화
class QuoteService {
  private repository: QuoteRepository;

  async getTodaysQuote(): Promise<Quote | null> {
    const today = this.formatDate(new Date());
    const dailyQuote = await this.repository.getDailyQuote(today);

    if (!dailyQuote) {
      // 오늘의 글이 없으면 스케줄러 실행
      await this.selectRandomQuote();
      return await this.repository.getDailyQuote(today);
    }

    return await this.repository.getQuoteById(dailyQuote.quote_id);
  }

  async selectRandomQuote(): Promise<void> {
    const cutoffDate = this.getCutoffDate(100); // 100일 전
    const availableQuotes = await this.repository.getAvailableQuotes(cutoffDate);

    if (availableQuotes.length === 0) {
      throw new Error('사용 가능한 글이 없습니다');
    }

    const randomQuote = this.pickRandom(availableQuotes);
    await this.repository.setDailyQuote(randomQuote.id);
    await this.repository.updateLastShownDate(randomQuote.id);
  }
}
```

### 💾 데이터 접근 레이어
```typescript
// repositories/QuoteRepository.ts
class QuoteRepository {
  private db = admin.firestore();

  async getQuoteById(id: string): Promise<Quote | null> {
    const doc = await this.db.collection('quotes').doc(id).get();
    return doc.exists ? this.mapToQuote(doc) : null;
  }

  async getAvailableQuotes(cutoffDate: string): Promise<Quote[]> {
    const snapshot = await this.db.collection('quotes')
      .where('status', '==', 'published')
      .where('last_shown_date', '<=', cutoffDate)
      .get();

    return snapshot.docs.map(doc => this.mapToQuote(doc));
  }

  private mapToQuote(doc: FirebaseFirestore.DocumentSnapshot): Quote {
    const data = doc.data()!;
    return {
      id: doc.id,
      type: data.type,
      content: data.content,
      like_count: data.like_count,
      last_shown_date: data.last_shown_date,
      status: data.status
    };
  }
}
```

---

## Firebase 활용 전략

### 🔥 현재 (MVP) 단계
```yaml
필수 서비스:
  Firestore:
    - quotes, submissions, daily_quotes 컬렉션
    - 실시간 리스너 (공감 수 업데이트)

  Cloud Functions:
    - selectDailyQuote (스케줄 함수)
    - HTTP API 엔드포인트들

  Hosting:
    - React 앱 배포
    - 커스텀 도메인 연결

선택적 서비스:
  Analytics: 기본 트래픽 분석
  Performance: 페이지 로딩 속도 모니터링
```

### 📈 확장 단계별 Firebase 활용

#### 6개월 후 (사용자 인증 추가)
```typescript
// Authentication 도입
import { getAuth, signInAnonymously } from 'firebase/auth';

// 익명 인증으로 시작 → 향후 소셜 로그인 확장
const auth = getAuth();
await signInAnonymously(auth);

// Firestore 보안 규칙 강화
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /user_favorites/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

#### 1년 후 (풀 스택 확장)
```typescript
// Storage 활용 (이미지 인용구)
import { getStorage, ref, uploadBytes } from 'firebase/storage';

// Remote Config (A/B 테스팅, 기능 플래그)
import { getRemoteConfig, fetchAndActivate } from 'firebase/remote-config';

// App Check (보안 강화)
import { getAppCheck, initializeAppCheck } from 'firebase/app-check';
```

---

## 폴더 구조 및 코드 조직

### 📁 전체 프로젝트 구조
```
📁 daily-quote/
├── 🎨 frontend/                 # React 앱
├── ⚙️  functions/                # Firebase Functions (백엔드)
├── 📦 shared/                   # 공통 타입, 유틸리티
├── 📋 docs/                     # 설계 문서, API 문서
├── 🧪 e2e/                      # E2E 테스트
├── 🔧 .github/                  # GitHub Actions
├── 🔥 firebase.json             # Firebase 설정
├── 📄 package.json              # 루트 의존성
└── 📖 README.md                 # 프로젝트 개요
```

### 🎨 Frontend 구조 (Feature-Based)
```
📁 frontend/src/
├── 🎯 features/                 # 기능별 모듈
│   ├── quote/                   # 글 관련 기능
│   │   ├── components/          # QuoteCard, QuoteActions 등
│   │   ├── hooks/               # useQuote, useLike 등
│   │   ├── services/            # quote API 호출
│   │   └── types/               # 글 관련 타입
│   ├── submission/              # 제출 관련
│   └── admin/                   # 관리자 기능
├── 🧩 shared/                   # 공통 컴포넌트
│   ├── components/              # Button, Input, Modal 등
│   │   ├── atoms/
│   │   ├── molecules/
│   │   └── organisms/
│   ├── hooks/                   # useLocalStorage 등
│   ├── utils/                   # 유틸리티 함수
│   └── constants/               # 상수 정의
├── 🏠 pages/                    # 페이지 컴포넌트
├── 🎨 styles/                   # 글로벌 스타일, 테마
├── 📡 services/                 # API 설정, Firebase 초기화
├── 🗄️  store/                   # 상태 관리 (Zustand)
└── 📱 App.tsx                   # 앱 엔트리포인트
```

### ⚙️ Backend 구조 (Layer-Based)
```
📁 functions/src/
├── 🌐 api/                      # HTTP 엔드포인트
│   ├── quotes.ts                # GET /quotes, POST /quotes/:id/like
│   ├── submissions.ts           # POST /submissions
│   └── admin.ts                 # 관리자 API
├── 📋 services/                 # 비즈니스 로직
│   ├── QuoteService.ts
│   ├── SubmissionService.ts
│   └── AdminService.ts
├── 💾 repositories/             # 데이터 접근
│   ├── QuoteRepository.ts
│   └── SubmissionRepository.ts
├── ⏰ schedulers/               # 스케줄 함수
│   └── dailyQuoteSelector.ts
├── 🔧 utils/                    # 유틸리티
├── 📡 config/                   # Firebase 설정
└── 📄 index.ts                  # Functions 엔트리포인트
```

### 📦 공통 모듈 (Shared)
```
📁 shared/
├── 📝 types/                    # 공통 타입 정의
│   ├── Quote.ts
│   ├── Submission.ts
│   └── ApiResponse.ts
├── 🔧 utils/                    # 공통 유틸리티
│   ├── dateUtils.ts
│   └── validationUtils.ts
└── 📊 constants/                # 공통 상수
    └── index.ts
```

---

## 성능 최적화 계획

### ⚡ 프론트엔드 성능 최적화
```typescript
// 코드 스플리팅 & 레이지 로딩
const HomePage = lazy(() =>
  import('../pages/HomePage').then(module => ({
    default: module.HomePage
  }))
);

// 이미지 최적화
const OptimizedImage = ({ src, alt, ...props }) => (
  <img
    src={src}
    alt={alt}
    loading="lazy"
    decoding="async"
    {...props}
  />
);

// 메모이제이션 전략
const QuoteCard = memo(({ quote, onLike }) => {
  const handleLike = useCallback(() => {
    onLike(quote.id);
  }, [quote.id, onLike]);

  return (
    <Card>
      <Typography>{quote.content}</Typography>
      <Button onClick={handleLike}>❤️ {quote.like_count}</Button>
    </Card>
  );
});
```

### 🔧 백엔드 성능 최적화
```typescript
// Firestore 쿼리 최적화
class QuoteRepository {
  // 복합 인덱스 활용
  async getAvailableQuotes(cutoffDate: string, limit: number = 50) {
    return await this.db.collection('quotes')
      .where('status', '==', 'published')
      .where('last_shown_date', '<=', cutoffDate)
      .orderBy('last_shown_date', 'asc')
      .limit(limit)  // 페이지네이션
      .get();
  }

  // 캐싱 전략
  private cache = new Map();

  async getTodaysQuote(): Promise<Quote | null> {
    const today = this.getToday();
    const cached = this.cache.get(`daily-${today}`);

    if (cached) return cached;

    const quote = await this.fetchTodaysQuote();
    this.cache.set(`daily-${today}`, quote);
    return quote;
  }
}
```

### 📊 성능 모니터링 설정
```typescript
// Firebase Performance Monitoring
import { getPerformance, trace } from 'firebase/performance';

const perf = getPerformance();

// 커스텀 트레이스
const loadQuoteTrace = trace(perf, 'load_quote');
loadQuoteTrace.start();

try {
  const quote = await fetchTodaysQuote();
  loadQuoteTrace.putAttribute('quote_length', quote.content.length.toString());
} finally {
  loadQuoteTrace.stop();
}

// Web Vitals 모니터링
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

getCLS(console.log);
getFID(console.log);
getFCP(console.log);
getLCP(console.log);
getTTFB(console.log);
```

### 💾 캐싱 전략
```typescript
// Service Worker (PWA)
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js');
}

// TanStack Query 캐싱
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60 * 30, // 30분
      cacheTime: 1000 * 60 * 60, // 1시간
    },
  },
});
```

---

## CI/CD 및 배포 전략

### 🚀 GitHub Actions 워크플로우
```yaml
# .github/workflows/deploy.yml
name: Deploy Daily Quote

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

env:
  NODE_VERSION: '18'

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: ${{ env.NODE_VERSION }}

      # 의존성 설치
      - name: Install dependencies
        run: |
          npm ci
          cd frontend && npm ci
          cd ../functions && npm ci

      # 코드 품질 체크
      - name: Run linting
        run: |
          npm run lint:frontend
          npm run lint:functions

      # 타입 체크
      - name: Type check
        run: |
          npm run type-check:frontend
          npm run type-check:functions

      # 테스트 실행
      - name: Run tests
        run: |
          npm run test:frontend
          npm run test:functions

  build:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/develop'

    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3

      # 환경별 빌드
      - name: Build frontend
        env:
          REACT_APP_ENV: ${{ github.ref == 'refs/heads/main' && 'production' || 'development' }}
        run: |
          cd frontend
          npm run build

      # Firebase 배포
      - name: Deploy to Firebase
        uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT }}'
          projectId: daily-quote-prod
          channelId: ${{ github.ref == 'refs/heads/main' && 'live' || 'preview' }}
```

### 🌍 환경별 배포 전략
```
🌍 환경 구성:
├── 🔴 Production (main branch)
│   ├── Firebase Project: daily-quote-prod
│   ├── Domain: dailyquote.com
│   └── DB: production firestore
│
├── 🟡 Staging (develop branch)
│   ├── Firebase Project: daily-quote-staging
│   ├── Domain: staging.dailyquote.com
│   └── DB: staging firestore
│
└── 🟢 Development (feature branches)
    ├── Firebase Project: daily-quote-dev
    ├── Domain: dev.dailyquote.com
    └── DB: development firestore
```

### 🔧 Firebase 프로젝트 설정
```json
// .firebaserc - 환경별 프로젝트 매핑
{
  "projects": {
    "default": "daily-quote-dev",
    "production": "daily-quote-prod",
    "staging": "daily-quote-staging"
  }
}

// firebase.json - 배포 설정
{
  "hosting": {
    "public": "frontend/dist",
    "ignore": ["firebase.json", "**/.*", "**/node_modules/**"],
    "rewrites": [{
      "source": "**",
      "destination": "/index.html"
    }]
  },
  "functions": {
    "source": "functions",
    "runtime": "nodejs18",
    "predeploy": "npm run build"
  },
  "firestore": {
    "rules": "firestore.rules",
    "indexes": "firestore.indexes.json"
  }
}
```

### 📋 브랜치 전략 (GitHub Flow)
```
📋 브랜치 전략:
├── main          → Production 배포 (자동)
├── develop       → Staging 배포 (자동)
└── feature/*     → PR 생성 → 리뷰 → develop 머지

🔄 배포 프로세스:
1. Feature 개발 → feature/quote-card 브랜치
2. PR 생성 → 자동 테스트 실행
3. 코드 리뷰 → develop 브랜치 머지
4. Staging 환경 자동 배포 → QA 테스트
5. develop → main PR → Production 배포
```

---

## 단계별 실행 계획

### 🚀 Phase 1: 프로젝트 초기 설정 (1주차)
- [ ] Firebase 프로젝트 생성 (dev, staging, prod)
- [ ] 폴더 구조 생성 및 기본 설정 파일 작성
- [ ] package.json, tsconfig.json, eslint, prettier 설정
- [ ] GitHub 저장소 생성 및 브랜치 전략 설정
- [ ] 기본 CI/CD 파이프라인 구축

### 🎨 Phase 2: 프론트엔드 기반 구조 (2주차)
- [ ] React 앱 초기 설정 (Vite + TypeScript + MUI)
- [ ] 상태 관리 설정 (Zustand + TanStack Query)
- [ ] 기본 컴포넌트 라이브러리 구축 (Atomic Design)
- [ ] 라우팅 설정 및 기본 페이지 구조
- [ ] Firebase 연결 및 초기 설정

### ⚙️ Phase 3: 백엔드 핵심 기능 (3주차)
- [ ] Firebase Functions 프로젝트 설정
- [ ] Firestore 데이터 모델 구현 및 보안 규칙
- [ ] 서비스 레이어 구현 (QuoteService, SubmissionService)
- [ ] Repository 패턴 구현
- [ ] 스케줄러 함수 구현 (오늘의 글 선정)

### 🔧 Phase 4: API 및 통합 (4주차)
- [ ] HTTP API 엔드포인트 구현
- [ ] 프론트엔드-백엔드 통합
- [ ] 실시간 기능 구현 (공감 수 실시간 업데이트)
- [ ] 에러 핸들링 및 로딩 상태 관리
- [ ] 기본 테스트 작성

### 🎯 Phase 5: 핵심 기능 완성 (5-6주차)
- [ ] 메인 페이지 완성 (오늘의 글 표시)
- [ ] 글 제출 페이지 구현
- [ ] 관리자 페이지 구현 (기본 기능)
- [ ] 공감 기능 및 공유 기능
- [ ] 반응형 디자인 적용

### 🚀 Phase 6: 최적화 및 배포 (7주차)
- [ ] 성능 최적화 (코드 스플리팅, 레이지 로딩)
- [ ] SEO 최적화 및 메타 태그 설정
- [ ] PWA 기능 추가
- [ ] 모니터링 및 분석 도구 설정
- [ ] 프로덕션 배포 및 도메인 연결

### 📊 Phase 7: 검증 및 개선 (8주차)
- [ ] 사용자 테스트 및 피드백 수집
- [ ] 버그 수정 및 개선사항 적용
- [ ] 문서화 작업 완료
- [ ] 차기 버전 계획 수립

---

## 📝 핵심 설계 결정사항

### ✅ 주요 아키텍처 선택
1. **상태 관리**: Zustand + TanStack Query (가벼우면서 확장 가능)
2. **컴포넌트 설계**: Atomic Design (재사용성 최대화)
3. **백엔드 패턴**: 레이어드 아키텍처 (유지보수성)
4. **폴더 구조**: Feature-based (기능별 모듈화)
5. **배포 전략**: GitHub Actions + 환경별 Firebase 프로젝트

### 🔄 확장성 확보 방안
- **모듈화**: 기능별 독립적인 모듈 설계
- **타입 안정성**: 엄격한 TypeScript 적용
- **테스트 가능성**: 의존성 주입 및 추상화
- **성능 고려**: 코드 스플리팅 및 최적화 전략
- **모니터링**: 성능 및 사용자 행동 분석

---